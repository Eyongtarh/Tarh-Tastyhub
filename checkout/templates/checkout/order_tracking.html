{% extends 'base.html' %}
{% block content %}
  <div class="container text-center">
    <h2 class="fw-bold mb-4"><span class="fa-icon"><i class="fa-solid fa-box"></i></span>Order Tracking</h2>
    <p class="lead">Order #{{ order.order_number }}</p>

    <div class="progress" style="height:30px;">
      <div id="order-progress" class="progress-bar progress-bar-striped bg-warning" style="width:{{ order.progress_percent }}%;">{{ order.status }}</div>
    </div>

    <p class="mt-3 text-muted">Weâ€™ll update you live when your meal is being prepared ğŸ³, out for delivery ğŸš—, or ready for pickup ğŸ±.</p>
  </div>

  <script>
    ;(function () {
      const wsProtocol = window.location.protocol === 'https:' ? 'wss' : 'ws'
      const orderNumber = '{{ order.order_number }}'
      const orderSocket = new WebSocket(wsProtocol + '://' + window.location.host + '/ws/order/' + orderNumber + '/')
    
      orderSocket.onmessage = (e) => {
        const data = JSON.parse(e.data)
        const progress = data.progress || 0
        const status = data.status || ''
        const progressEl = document.getElementById('order-progress')
        if (progressEl) {
          progressEl.style.width = progress + '%'
          progressEl.textContent = status
        }
      }
    
      orderSocket.onclose = () => console.warn('Order tracking websocket closed')
    })()
  </script>
{% endblock %}
