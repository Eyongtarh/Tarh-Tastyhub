{% extends "base.html" %}
{% block content %}
<div class="container">
  <h2 class="fw-bold text-center mb-4">
    <span class="fa-icon"><i class="fa-solid fa-screwdriver-wrench"></i></span>
    Admin Dashboard
  </h2>

  <div class="table-responsive">
    <table class="table table-hover align-middle shadow-sm">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>Customer</th>
          <th>Total ($)</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="orders-table">
        {% for order in orders %}
        <tr id="order-{{ order.id }}">
          <td>{{ order.id }}</td>
          <td>{{ order.full_name }}</td>
          <td>{{ order.grand_total }}</td>
          <td>{{ order.status }}</td>
          <td>
            <form method="POST" action="{% url 'update_order_status' order.id %}" class="d-flex">
              {% csrf_token %}
              <select name="status" class="form-select form-select-sm me-2">
                <option {% if order.status == 'Pending' %}selected{% endif %}>Pending</option>
                <option {% if order.status == 'Preparing' %}selected{% endif %}>Preparing</option>
                <option {% if order.status == 'Out for Delivery' %}selected{% endif %}>Out for Delivery</option>
                <option {% if order.status == 'Completed' %}selected{% endif %}>Completed</option>
              </select>
              <button class="btn btn-warning btn-sm">Update</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<script>
  const adminSocket = new WebSocket('ws://' + window.location.host + '/ws/admin/');

  adminSocket.onmessage = (e) => {
    const data = JSON.parse(e.data);
    const statusCell = document.querySelector(`#order-${data.id} td:nth-child(4)`);
    if (statusCell) statusCell.textContent = data.status;
  };
</script>
{% endblock %}
