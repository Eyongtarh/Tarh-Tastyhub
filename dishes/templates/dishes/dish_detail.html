{% extends 'base.html' %}
{% load static %}

{% block title %}
  {{ dish.name }} - Tarh Tastyhub
{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="row">
    <!-- Dish Image -->
    <div class="col-md-6">
      {% if dish.image %}
        <img src="{{ dish.image.url }}" class="img-fluid rounded-4" alt="{{ dish.name }}" />
      {% else %}
        <img src="{% static 'images/no-image.png' %}" class="img-fluid rounded-4" alt="No Image" />
      {% endif %}
    </div>

    <!-- Dish Info -->
    <div class="col-md-6">
      <h2 class="fw-bold">{{ dish.name }}</h2>
      <p class="text-muted">{{ dish.description }}</p>

      <!-- Portion Select -->
      {% if dish.portions.exists %}
        <select class="form-select mb-2 portion-select" aria-label="Select portion">
          {% for portion in dish.portions.all %}
            <option value="{{ portion.id }}" data-price="{{ portion.price }}" {% if forloop.first %}selected{% endif %}>
              {{ portion.size }} - ₦{{ portion.price }}
            </option>
          {% endfor %}
        </select>
        <p class="fw-bold text-warning dish-price">₦{{ dish.portions.first.price }}</p>
        {% with portion_id=dish.portions.first.id %}
          {% comment %}Used in data-portion-id for JS{% endcomment %}
        {% endwith %}
      {% else %}
        <p class="fw-bold text-warning dish-price">₦{{ dish.price }}</p>
        {% with portion_id=dish.id %}
        {% endwith %}
      {% endif %}

      <!-- Quantity Controls -->
      <div class="d-flex align-items-center gap-2 mb-3">
        <button type="button" class="btn btn-outline-secondary dish-qty-decrement">-</button>
        <input type="number"
               class="form-control dish-qty"
               value="1"
               min="1"
               style="width:70px;"
               data-portion-id="{% if dish.portions.exists %}{{ dish.portions.first.id }}{% else %}{{ dish.id }}{% endif %}" />
        <button type="button" class="btn btn-outline-secondary dish-qty-increment">+</button>
      </div>

      <!-- Add to Bag Button -->
      <button class="btn btn-warning fw-bold add-to-bag"
              data-id="{{ dish.id }}"
              data-portion-id="{% if dish.portions.exists %}{{ dish.portions.first.id }}{% else %}{{ dish.id }}{% endif %}">
        Add to Bag
      </button>

      <!-- Optional Dish Info -->
      {% if dish.ingredients %}
        <hr />
        <h6>Ingredients:</h6>
        <p>{{ dish.ingredients }}</p>
      {% endif %}

      {% if dish.dietary_info %}
        <p><strong>Dietary Info:</strong> {{ dish.dietary_info }}</p>
      {% endif %}

      {% if dish.prep_time %}
        <p><strong>Preparation Time:</strong> {{ dish.prep_time }} min</p>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
